<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<style type="text/css">
@font-face {
font-family: octicons-link;
src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}
body {
-webkit-text-size-adjust: 100%;
text-size-adjust: 100%;
color: #333;
font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
font-size: 16px;
line-height: 1.6;
word-wrap: break-word;
}
a {
background-color: transparent;
}
a:active,
a:hover {
outline: 0;
}
strong {
font-weight: bold;
}
h1 {
font-size: 2em;
margin: 0.67em 0;
}
img {
border: 0;
}
hr {
box-sizing: content-box;
height: 0;
}
pre {
overflow: auto;
}
code,
kbd,
pre {
font-family: monospace, monospace;
font-size: 1em;
}
input {
color: inherit;
font: inherit;
margin: 0;
}
html input[disabled] {
cursor: default;
}
input {
line-height: normal;
}
input[type="checkbox"] {
box-sizing: border-box;
padding: 0;
}
table {
border-collapse: collapse;
border-spacing: 0;
}
td,
th {
padding: 0;
}
* {
box-sizing: border-box;
}
input {
font: 13px / 1.4 Helvetica, arial, nimbussansl, liberationsans, freesans, clean, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
}
a {
color: #4078c0;
text-decoration: none;
}
a:hover,
a:active {
text-decoration: underline;
}
hr {
height: 0;
margin: 15px 0;
overflow: hidden;
background: transparent;
border: 0;
border-bottom: 1px solid #ddd;
}
hr:before {
display: table;
content: "";
}
hr:after {
display: table;
clear: both;
content: "";
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 15px;
margin-bottom: 15px;
line-height: 1.1;
}
h1 {
font-size: 30px;
}
h2 {
font-size: 21px;
}
h3 {
font-size: 16px;
}
h4 {
font-size: 14px;
}
h5 {
font-size: 12px;
}
h6 {
font-size: 11px;
}
blockquote {
margin: 0;
}
ul,
ol {
padding: 0;
margin-top: 0;
margin-bottom: 0;
}
ol ol,
ul ol {
list-style-type: lower-roman;
}
ul ul ol,
ul ol ol,
ol ul ol,
ol ol ol {
list-style-type: lower-alpha;
}
dd {
margin-left: 0;
}
code {
font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
font-size: 12px;
}
pre {
margin-top: 0;
margin-bottom: 0;
font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}
.select::-ms-expand {
opacity: 0;
}
.octicon {
font: normal normal normal 16px/1 octicons-link;
display: inline-block;
text-decoration: none;
text-rendering: auto;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
-webkit-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
}
.octicon-link:before {
content: '\f05c';
}
.markdown-body:before {
display: table;
content: "";
}
.markdown-body:after {
display: table;
clear: both;
content: "";
}
.markdown-body>*:first-child {
margin-top: 0 !important;
}
.markdown-body>*:last-child {
margin-bottom: 0 !important;
}
a:not([href]) {
color: inherit;
text-decoration: none;
}
.anchor {
display: inline-block;
padding-right: 2px;
margin-left: -18px;
}
.anchor:focus {
outline: none;
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 1em;
margin-bottom: 16px;
font-weight: bold;
line-height: 1.4;
}
h1 .octicon-link,
h2 .octicon-link,
h3 .octicon-link,
h4 .octicon-link,
h5 .octicon-link,
h6 .octicon-link {
color: #000;
vertical-align: middle;
visibility: hidden;
}
h1:hover .anchor,
h2:hover .anchor,
h3:hover .anchor,
h4:hover .anchor,
h5:hover .anchor,
h6:hover .anchor {
text-decoration: none;
}
h1:hover .anchor .octicon-link,
h2:hover .anchor .octicon-link,
h3:hover .anchor .octicon-link,
h4:hover .anchor .octicon-link,
h5:hover .anchor .octicon-link,
h6:hover .anchor .octicon-link {
visibility: visible;
}
h1 {
padding-bottom: 0.3em;
font-size: 2.25em;
line-height: 1.2;
border-bottom: 1px solid #eee;
}
h1 .anchor {
line-height: 1;
}
h2 {
padding-bottom: 0.3em;
font-size: 1.75em;
line-height: 1.225;
border-bottom: 1px solid #eee;
}
h2 .anchor {
line-height: 1;
}
h3 {
font-size: 1.5em;
line-height: 1.43;
}
h3 .anchor {
line-height: 1.2;
}
h4 {
font-size: 1.25em;
}
h4 .anchor {
line-height: 1.2;
}
h5 {
font-size: 1em;
}
h5 .anchor {
line-height: 1.1;
}
h6 {
font-size: 1em;
color: #777;
}
h6 .anchor {
line-height: 1.1;
}
p,
blockquote,
ul,
ol,
dl,
table,
pre {
margin-top: 0;
margin-bottom: 16px;
}
hr {
height: 4px;
padding: 0;
margin: 16px 0;
background-color: #e7e7e7;
border: 0 none;
}
ul,
ol {
padding-left: 2em;
}
ul ul,
ul ol,
ol ol,
ol ul {
margin-top: 0;
margin-bottom: 0;
}
li>p {
margin-top: 16px;
}
dl {
padding: 0;
}
dl dt {
padding: 0;
margin-top: 16px;
font-size: 1em;
font-style: italic;
font-weight: bold;
}
dl dd {
padding: 0 16px;
margin-bottom: 16px;
}
blockquote {
padding: 0 15px;
color: #777;
border-left: 4px solid #ddd;
}
blockquote>:first-child {
margin-top: 0;
}
blockquote>:last-child {
margin-bottom: 0;
}
table {
display: block;
width: 100%;
overflow: auto;
word-break: normal;
word-break: keep-all;
}
table th {
font-weight: bold;
}
table th,
table td {
padding: 6px 13px;
border: 1px solid #ddd;
}
table tr {
background-color: #fff;
border-top: 1px solid #ccc;
}
table tr:nth-child(2n) {
background-color: #f8f8f8;
}
img {
max-width: 100%;
box-sizing: content-box;
background-color: #fff;
}
code {
padding: 0;
padding-top: 0.2em;
padding-bottom: 0.2em;
margin: 0;
font-size: 85%;
background-color: rgba(0,0,0,0.04);
border-radius: 3px;
}
code:before,
code:after {
letter-spacing: -0.2em;
content: "\00a0";
}
pre>code {
padding: 0;
margin: 0;
font-size: 100%;
word-break: normal;
white-space: pre;
background: transparent;
border: 0;
}
.highlight {
margin-bottom: 16px;
}
.highlight pre,
pre {
padding: 16px;
overflow: auto;
font-size: 85%;
line-height: 1.45;
background-color: #f7f7f7;
border-radius: 3px;
}
.highlight pre {
margin-bottom: 0;
word-break: normal;
}
pre {
word-wrap: normal;
}
pre code {
display: inline;
max-width: initial;
padding: 0;
margin: 0;
overflow: initial;
line-height: inherit;
word-wrap: normal;
background-color: transparent;
border: 0;
}
pre code:before,
pre code:after {
content: normal;
}
kbd {
display: inline-block;
padding: 3px 5px;
font-size: 11px;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.pl-c {
color: #969896;
}
.pl-c1,
.pl-s .pl-v {
color: #0086b3;
}
.pl-e,
.pl-en {
color: #795da3;
}
.pl-s .pl-s1,
.pl-smi {
color: #333;
}
.pl-ent {
color: #63a35c;
}
.pl-k {
color: #a71d5d;
}
.pl-pds,
.pl-s,
.pl-s .pl-pse .pl-s1,
.pl-sr,
.pl-sr .pl-cce,
.pl-sr .pl-sra,
.pl-sr .pl-sre {
color: #183691;
}
.pl-v {
color: #ed6a43;
}
.pl-id {
color: #b52a1d;
}
.pl-ii {
background-color: #b52a1d;
color: #f8f8f8;
}
.pl-sr .pl-cce {
color: #63a35c;
font-weight: bold;
}
.pl-ml {
color: #693a17;
}
.pl-mh,
.pl-mh .pl-en,
.pl-ms {
color: #1d3e81;
font-weight: bold;
}
.pl-mq {
color: #008080;
}
.pl-mi {
color: #333;
font-style: italic;
}
.pl-mb {
color: #333;
font-weight: bold;
}
.pl-md {
background-color: #ffecec;
color: #bd2c00;
}
.pl-mi1 {
background-color: #eaffea;
color: #55a532;
}
.pl-mdr {
color: #795da3;
font-weight: bold;
}
.pl-mo {
color: #1d3e81;
}
kbd {
display: inline-block;
padding: 3px 5px;
font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.task-list-item {
list-style-type: none;
}
.task-list-item+.task-list-item {
margin-top: 3px;
}
.task-list-item input {
margin: 0 0.35em 0.25em -1.6em;
vertical-align: middle;
}
:checked+.radio-label {
z-index: 1;
position: relative;
border-color: #4078c0;
}
.sourceLine {
display: inline-block;
}
code .kw { color: #000000; }
code .dt { color: #ed6a43; }
code .dv { color: #009999; }
code .bn { color: #009999; }
code .fl { color: #009999; }
code .ch { color: #009999; }
code .st { color: #183691; }
code .co { color: #969896; }
code .ot { color: #0086b3; }
code .al { color: #a61717; }
code .fu { color: #63a35c; }
code .er { color: #a61717; background-color: #e3d2d2; }
code .wa { color: #000000; }
code .cn { color: #008080; }
code .sc { color: #008080; }
code .vs { color: #183691; }
code .ss { color: #183691; }
code .im { color: #000000; }
code .va {color: #008080; }
code .cf { color: #000000; }
code .op { color: #000000; }
code .bu { color: #000000; }
code .ex { color: #000000; }
code .pp { color: #999999; }
code .at { color: #008080; }
code .do { color: #969896; }
code .an { color: #008080; }
code .cv { color: #008080; }
code .in { color: #008080; }
</style>
<style>
body {
box-sizing: border-box;
min-width: 200px;
max-width: 980px;
margin: 0 auto;
padding: 45px;
padding-top: 0px;
}
</style>


</head>

<body>

<h1 id="mercury-mass-in-atmosphere">Mercury mass in atmosphere</h1>
<p>Martin Colomb 2025-06-17</p>
<h1 id="chargement-des-packages">Chargement des packages</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(akima)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(ncdf4)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="fu">library</span>(rnaturalearthdata)</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="fu">library</span>(maps)</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="fu">library</span>(geosphere)</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="fu">library</span>(writexl)</span></code></pre></div>
<h1 id="lecture-des-données">Lecture des données</h1>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>chem_hist_B100<span class="ot">&lt;-</span><span class="st">&quot;C:/Users/colom/Desktop/STAGE/data/clean_mod_data/14_3_1/HIST_B100&quot;</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>con_hg_B100<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="fu">file.path</span>(chem_hist_B100, <span class="st">&quot;GEOSChem.SpeciesConc.2015_m.nc4&quot;</span>))</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>statemet_B100<span class="ot">&lt;-</span><span class="fu">nc_open</span>(<span class="fu">file.path</span>(chem_hist_B100, <span class="st">&quot;GEOSChem.StateMet.2015_m.nc4&quot;</span>))</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>conc_hg0<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(con_hg_B100, <span class="st">&quot;SpeciesConcVV_Hg0&quot;</span>) <span class="co">#Concentration of species Hg0 (mol mol-1 dry)</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>Met_AIRVOL<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(statemet_B100, <span class="st">&quot;Met_AIRVOL&quot;</span>)  <span class="co">#Met_AIRVOL (Volume of grid box m3)</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>Met_AIRDEN<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(statemet_B100, <span class="st">&quot;Met_AIRDEN&quot;</span>)  <span class="co">#Met_AIRDEN (Dry air density kg m-3)</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>Met_AD<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(statemet_B100, <span class="st">&quot;Met_AD&quot;</span>)  <span class="co">#Met_AD (Dry air mass kg)</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>area<span class="ot">&lt;-</span><span class="fu">ncvar_get</span>(con_hg_B100, <span class="st">&quot;AREA&quot;</span>)</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>s_in_yr <span class="ot">=</span> <span class="fl">365.2425</span> <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>unit_conv <span class="ot">=</span> s_in_yr</span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>kg_Mg <span class="ot">=</span> <span class="fl">1e-3</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>MW_Hg <span class="ot">=</span> <span class="fl">200.59</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>avo <span class="ot">=</span> <span class="fl">6.02e23</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>g_kg <span class="ot">=</span> <span class="fl">1e-3</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>cm2_m2 <span class="ot">=</span> <span class="fl">1e4</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>unit_conv_dd <span class="ot">=</span> MW_Hg <span class="sc">/</span> avo <span class="sc">*</span> g_kg <span class="sc">*</span> cm2_m2 <span class="sc">*</span> s_in_yr <span class="sc">*</span> area</span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>M_Hg <span class="ot">&lt;-</span> <span class="fl">0.20059</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>M_air <span class="ot">&lt;-</span> <span class="fl">0.028964</span></span></code></pre></div>
<h1 id="the-conversion-formula-is">The conversion formula is:</h1>
<pre><code>    mol species                g/mol species
    ----------- * kg dry air * -------------
    mol dry air                g/mol dry air

    = volume mixing ratio * dry air mass * MW species / MW dry air

    = kg species
    
        
    MW dry air is defined as 28.9644 g/mol
    https://github.com/geoschem/geos-chem/blob/4722f288e90291ba904222f4bbe4fc216d17c34a/Headers/physconstants.F90#L26</code></pre>
<h1 id="calcul-de-la-masse-de-mercure-dans-latmosphère-sur-lannée">Calcul de
la masse de mercure dans l’atmosphère sur l’année</h1>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Moyenne temporelle sur les 12 mois</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>mean_conc_hg0 <span class="ot">&lt;-</span> <span class="fu">apply</span>(conc_hg0, <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>mean_Met_AD <span class="ot">&lt;-</span> <span class="fu">apply</span>(Met_AD, <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co"># Calcul de la masse de Hg (en kg) dans chaque maille</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>mass_hg <span class="ot">&lt;-</span> mean_conc_hg0 <span class="sc">*</span> mean_Met_AD <span class="sc">*</span> (M_Hg <span class="sc">/</span> M_air)</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co"># Masse totale de Hg dans toute l&#39;atmosphère (somme de toutes les mailles)</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>total_mass_hg <span class="ot">&lt;-</span> <span class="fu">sum</span>(mass_hg, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)  <span class="co"># en kg</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>total_mass_hg_tonnes <span class="ot">&lt;-</span> total_mass_hg <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="fu">print</span>(total_mass_hg_tonnes)</span></code></pre></div>
<pre><code>## [1] 3757.912</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>state_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(chem_hist_B100, <span class="at">pattern =</span> <span class="st">&quot;GEOSChem.StateMet.*</span><span class="sc">\\</span><span class="st">.nc4$&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>chem_files  <span class="ot">&lt;-</span> <span class="fu">list.files</span>(chem_hist_B100, <span class="at">pattern =</span> <span class="st">&quot;GEOSChem.SpeciesConc.*</span><span class="sc">\\</span><span class="st">.nc4$&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co"># Supprimer les fichiers de moyenne annuelle que l&#39;on ne veut pas traiter</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>exclude_states <span class="ot">&lt;-</span> <span class="st">&quot;GEOSChem.StateMet.2015_m.nc4&quot;</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>exclude_chems  <span class="ot">&lt;-</span> <span class="st">&quot;GEOSChem.SpeciesConc.2015_m.nc4&quot;</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>state_files <span class="ot">&lt;-</span> state_files[<span class="sc">!</span><span class="fu">basename</span>(state_files) <span class="sc">%in%</span> exclude_states]</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>chem_files  <span class="ot">&lt;-</span> chem_files[<span class="sc">!</span><span class="fu">basename</span>(chem_files) <span class="sc">%in%</span> exclude_chems]</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>masses_tonnes <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(state_files)) {</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>  <span class="co"># Ouvrir fichiers</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>  nc_statemet <span class="ot">&lt;-</span> <span class="fu">nc_open</span>(state_files[i])</span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>  nc_chem     <span class="ot">&lt;-</span> <span class="fu">nc_open</span>(chem_files[i])</span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>  <span class="co"># Lire les variables</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>  Met_AD    <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_statemet, <span class="st">&quot;Met_AD&quot;</span>)            <span class="co"># kg</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a>  conc_hg0  <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(nc_chem,     <span class="st">&quot;SpeciesConcVV_Hg0&quot;</span>) <span class="co"># mol/mol</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a>  <span class="co"># Calcul masse</span></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a>  mass_hg <span class="ot">&lt;-</span> conc_hg0 <span class="sc">*</span> Met_AD <span class="sc">*</span> (M_Hg <span class="sc">/</span> M_air)</span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a>  total_mass_kg <span class="ot">&lt;-</span> <span class="fu">sum</span>(mass_hg, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a>  total_mass_tonnes <span class="ot">&lt;-</span> total_mass_kg <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a></span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a>  <span class="co"># Extraire la date depuis le nom de fichier</span></span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a>  file_date <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(<span class="fu">basename</span>(state_files[i]), <span class="st">&quot;</span><span class="sc">\\</span><span class="st">d{8}&quot;</span>)</span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a>  file_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(file_date, <span class="at">format =</span> <span class="st">&quot;%Y%m%d&quot;</span>)</span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a>  <span class="co"># Stocker résultats</span></span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a>  dates <span class="ot">&lt;-</span> <span class="fu">c</span>(dates, file_date)</span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a>  masses_tonnes <span class="ot">&lt;-</span> <span class="fu">c</span>(masses_tonnes, total_mass_tonnes)</span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" tabindex="-1"></a>  <span class="co"># Fermer fichiers</span></span>
<span id="cb6-38"><a href="#cb6-38" tabindex="-1"></a>  <span class="fu">nc_close</span>(nc_statemet)</span>
<span id="cb6-39"><a href="#cb6-39" tabindex="-1"></a>  <span class="fu">nc_close</span>(nc_chem)</span>
<span id="cb6-40"><a href="#cb6-40" tabindex="-1"></a>}</span>
<span id="cb6-41"><a href="#cb6-41" tabindex="-1"></a></span>
<span id="cb6-42"><a href="#cb6-42" tabindex="-1"></a>df_mass <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb6-43"><a href="#cb6-43" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(dates),  <span class="co"># forcer ici</span></span>
<span id="cb6-44"><a href="#cb6-44" tabindex="-1"></a>  <span class="at">mass_tonnes =</span> masses_tonnes</span>
<span id="cb6-45"><a href="#cb6-45" tabindex="-1"></a>)</span></code></pre></div>
<h1 id="plot-de-la-masse-totale-de-hg⁰-tonnes-par-mois">PLOT DE LA MASSE
TOTALE DE Hg⁰ (tonnes) PAR MOIS</h1>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">ggplot</span>(df_mass, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> mass_tonnes)) <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a> <span class="co">#geom_line(color = &quot;steelblue&quot;, size = 1.2) +</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Évolution mensuelle de la masse de Hg⁰ dans l’atmosphère&quot;</span>,</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Date&quot;</span>,</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Masse totale de Hg⁰ (tonnes)&quot;</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2014-06-01&quot;</span>), <span class="at">y =</span> <span class="dv">3500</span>, <span class="at">label =</span> <span class="st">&quot;Spinup&quot;</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">fontface =</span> <span class="st">&quot;italic&quot;</span>)<span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">&quot;2 months&quot;</span>,</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">&quot;%Y-%m&quot;</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2015-01-01&quot;</span>), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>    <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>),</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>)</span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>  )</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">print</span>(df_mass)</span></code></pre></div>
<pre><code>## # A tibble: 24 × 2
##    date       mass_tonnes
##    &lt;date&gt;           &lt;dbl&gt;
##  1 2014-01-01        325.
##  2 2014-02-01        850.
##  3 2014-03-01       1290.
##  4 2014-04-01       1683.
##  5 2014-05-01       2027.
##  6 2014-06-01       2346.
##  7 2014-07-01       2613.
##  8 2014-08-01       2836.
##  9 2014-09-01       2990.
## 10 2014-10-01       3114.
## # ℹ 14 more rows</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>df_2015 <span class="ot">&lt;-</span> df_mass[<span class="fu">format</span>(df_mass<span class="sc">$</span>date, <span class="st">&quot;%Y&quot;</span>) <span class="sc">==</span> <span class="st">&quot;2015&quot;</span>, ]</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="fu">print</span>(df_2015)</span></code></pre></div>
<pre><code>## # A tibble: 12 × 2
##    date       mass_tonnes
##    &lt;date&gt;           &lt;dbl&gt;
##  1 2015-01-01       3444.
##  2 2015-02-01       3539.
##  3 2015-03-01       3615.
##  4 2015-04-01       3685.
##  5 2015-05-01       3768.
##  6 2015-06-01       3833.
##  7 2015-07-01       3857.
##  8 2015-08-01       3866.
##  9 2015-09-01       3860.
## 10 2015-10-01       3861.
## 11 2015-11-01       3865.
## 12 2015-12-01       3903.</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>mean_begin_2015 <span class="ot">&lt;-</span> <span class="fu">mean</span>(df_2015<span class="sc">$</span>mass_tonnes[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>mean_end_2015 <span class="ot">&lt;-</span> <span class="fu">mean</span>(df_2015<span class="sc">$</span>mass_tonnes[<span class="dv">7</span><span class="sc">:</span><span class="dv">12</span>])</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>mean_2015 <span class="ot">&lt;-</span> <span class="fu">mean</span>(df_2015<span class="sc">$</span>mass_tonnes)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Moyenne janvier–juin 2015 :&quot;</span>, <span class="fu">round</span>(mean_begin_2015, <span class="dv">2</span>), <span class="st">&quot;tonnes&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;Moyenne janvier–juin 2015 : 3647.51 tonnes&quot;</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Moyenne juillet–décembre 2015 :&quot;</span>, <span class="fu">round</span>(mean_end_2015, <span class="dv">2</span>), <span class="st">&quot;tonnes&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;Moyenne juillet–décembre 2015 : 3868.43 tonnes&quot;</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Moyenne annuelle 2015 :&quot;</span>, <span class="fu">round</span>(mean_2015, <span class="dv">2</span>), <span class="st">&quot;tonnes&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;Moyenne annuelle 2015 : 3757.97 tonnes&quot;</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># Constantes</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>kg_Mg <span class="ot">&lt;-</span> <span class="fl">1e-3</span>         <span class="co"># kg to Mg (tonnes)</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>s_in_yr <span class="ot">&lt;-</span> <span class="dv">365</span> <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">3600</span>  <span class="co"># seconds in a year</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a><span class="co"># Dossier principal</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>chem_hist <span class="ot">&lt;-</span> <span class="st">&quot;C:/Users/colom/Desktop/STAGE/data/clean_mod_data/14_3_1&quot;</span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="co"># Lister les sous-dossiers HIST_*</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>subdirs <span class="ot">&lt;-</span> <span class="fu">list.dirs</span>(chem_hist, <span class="at">full.names =</span> <span class="cn">TRUE</span>, <span class="at">recursive =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>subdirs <span class="ot">&lt;-</span> subdirs[<span class="fu">grepl</span>(<span class="st">&quot;HIST_&quot;</span>, <span class="fu">basename</span>(subdirs))]</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a><span class="co"># Initialiser un tableau pour stocker les résultats</span></span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a><span class="cf">for</span> (subdir <span class="cf">in</span> subdirs) {</span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a>  file_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(subdir, <span class="st">&quot;HEMCO_diagnostic_2015_m.nc4&quot;</span>)</span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a>  </span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file_path)) <span class="cf">next</span>  <span class="co"># skip si fichier manquant</span></span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a>  </span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a>  hemco_diagn <span class="ot">&lt;-</span> <span class="fu">nc_open</span>(file_path)</span>
<span id="cb18-21"><a href="#cb18-21" tabindex="-1"></a>  </span>
<span id="cb18-22"><a href="#cb18-22" tabindex="-1"></a>  <span class="co"># Extraire temps et poids mensuels</span></span>
<span id="cb18-23"><a href="#cb18-23" tabindex="-1"></a>  time_raw <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(hemco_diagn, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb18-24"><a href="#cb18-24" tabindex="-1"></a>  origin_time <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;2015-01-01 00:00:00&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;UTC&quot;</span>)</span>
<span id="cb18-25"><a href="#cb18-25" tabindex="-1"></a>  time <span class="ot">&lt;-</span> origin_time <span class="sc">+</span> time_raw <span class="sc">*</span> <span class="dv">60</span></span>
<span id="cb18-26"><a href="#cb18-26" tabindex="-1"></a>  weights <span class="ot">&lt;-</span> <span class="fu">days_in_month</span>(time) <span class="sc">/</span> <span class="fu">sum</span>(<span class="fu">days_in_month</span>(time))</span>
<span id="cb18-27"><a href="#cb18-27" tabindex="-1"></a>  </span>
<span id="cb18-28"><a href="#cb18-28" tabindex="-1"></a>  <span class="co"># Fonction de moyenne pondérée</span></span>
<span id="cb18-29"><a href="#cb18-29" tabindex="-1"></a>  weighted_avg <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">sum</span>(x <span class="sc">*</span> weights)</span>
<span id="cb18-30"><a href="#cb18-30" tabindex="-1"></a>  </span>
<span id="cb18-31"><a href="#cb18-31" tabindex="-1"></a>  <span class="co"># Aire des cellules</span></span>
<span id="cb18-32"><a href="#cb18-32" tabindex="-1"></a>  area <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(hemco_diagn, <span class="st">&quot;AREA&quot;</span>)  <span class="co"># en m²</span></span>
<span id="cb18-33"><a href="#cb18-33" tabindex="-1"></a></span>
<span id="cb18-34"><a href="#cb18-34" tabindex="-1"></a>  <span class="co"># Liste des variables d&#39;intérêt</span></span>
<span id="cb18-35"><a href="#cb18-35" tabindex="-1"></a>  vars <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb18-36"><a href="#cb18-36" tabindex="-1"></a>    <span class="at">biomass      =</span> <span class="st">&quot;EmisHg0_BioBurn&quot;</span>,</span>
<span id="cb18-37"><a href="#cb18-37" tabindex="-1"></a>    <span class="at">hg0_anthro   =</span> <span class="st">&quot;EmisHg0_Anthro&quot;</span>,</span>
<span id="cb18-38"><a href="#cb18-38" tabindex="-1"></a>    <span class="at">hg2_anthro   =</span> <span class="st">&quot;EmisHg2ClP_Anthro&quot;</span>,</span>
<span id="cb18-39"><a href="#cb18-39" tabindex="-1"></a>    <span class="at">hgp_anthro   =</span> <span class="st">&quot;EmisHgCl2_Anthro&quot;</span>,</span>
<span id="cb18-40"><a href="#cb18-40" tabindex="-1"></a>    <span class="at">geo          =</span> <span class="st">&quot;EmisHg0_Natural&quot;</span>,</span>
<span id="cb18-41"><a href="#cb18-41" tabindex="-1"></a>    <span class="at">asgm         =</span> <span class="st">&quot;EmisHg0_ASGM&quot;</span></span>
<span id="cb18-42"><a href="#cb18-42" tabindex="-1"></a>  )</span>
<span id="cb18-43"><a href="#cb18-43" tabindex="-1"></a>  </span>
<span id="cb18-44"><a href="#cb18-44" tabindex="-1"></a>  <span class="co"># Stockage temporaire</span></span>
<span id="cb18-45"><a href="#cb18-45" tabindex="-1"></a>  row <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">case =</span> <span class="fu">basename</span>(subdir))</span>
<span id="cb18-46"><a href="#cb18-46" tabindex="-1"></a>  </span>
<span id="cb18-47"><a href="#cb18-47" tabindex="-1"></a>  <span class="cf">for</span> (name <span class="cf">in</span> <span class="fu">names</span>(vars)) {</span>
<span id="cb18-48"><a href="#cb18-48" tabindex="-1"></a>    varname <span class="ot">&lt;-</span> vars[[name]]</span>
<span id="cb18-49"><a href="#cb18-49" tabindex="-1"></a>    emis <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(hemco_diagn, varname)  <span class="co"># [lon, lat, time]</span></span>
<span id="cb18-50"><a href="#cb18-50" tabindex="-1"></a>    emis_avg <span class="ot">&lt;-</span> <span class="fu">apply</span>(emis, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), weighted_avg)</span>
<span id="cb18-51"><a href="#cb18-51" tabindex="-1"></a>    total <span class="ot">&lt;-</span> <span class="fu">sum</span>(emis_avg <span class="sc">*</span> area <span class="sc">*</span> s_in_yr <span class="sc">*</span> kg_Mg, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-52"><a href="#cb18-52" tabindex="-1"></a>    row[[name]] <span class="ot">&lt;-</span> total</span>
<span id="cb18-53"><a href="#cb18-53" tabindex="-1"></a>  }</span>
<span id="cb18-54"><a href="#cb18-54" tabindex="-1"></a>  </span>
<span id="cb18-55"><a href="#cb18-55" tabindex="-1"></a>  <span class="co"># Ajouter les calculs additionnels</span></span>
<span id="cb18-56"><a href="#cb18-56" tabindex="-1"></a>  row<span class="sc">$</span>total_hg0      <span class="ot">&lt;-</span> row<span class="sc">$</span>hg0_anthro <span class="sc">+</span> row<span class="sc">$</span>asgm</span>
<span id="cb18-57"><a href="#cb18-57" tabindex="-1"></a>  row<span class="sc">$</span>total_hg2_hgp  <span class="ot">&lt;-</span> row<span class="sc">$</span>hg2_anthro <span class="sc">+</span> row<span class="sc">$</span>hgp_anthro</span>
<span id="cb18-58"><a href="#cb18-58" tabindex="-1"></a>  </span>
<span id="cb18-59"><a href="#cb18-59" tabindex="-1"></a>  <span class="co"># Ajouter au tableau final</span></span>
<span id="cb18-60"><a href="#cb18-60" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(results, <span class="fu">as_tibble</span>(row))</span>
<span id="cb18-61"><a href="#cb18-61" tabindex="-1"></a>  </span>
<span id="cb18-62"><a href="#cb18-62" tabindex="-1"></a>  <span class="fu">nc_close</span>(hemco_diagn)</span>
<span id="cb18-63"><a href="#cb18-63" tabindex="-1"></a>}</span>
<span id="cb18-64"><a href="#cb18-64" tabindex="-1"></a></span>
<span id="cb18-65"><a href="#cb18-65" tabindex="-1"></a><span class="fu">print</span>(results)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 9
##   case      biomass hg0_anthro hg2_anthro hgp_anthro   geo  asgm total_hg0 total_hg2_hgp
##   &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
## 1 HIST_B05     275.       987.       89.2       310.  250.  838.     1825.          399.
## 2 HIST_B10     275.       987.       89.2       310.  250.  838.     1825.          399.
## 3 HIST_B100    275.       987.       89.2       310.  250.  838.     1825.          399.
## 4 HIST_B150    275.       987.       89.2       310.  250.  838.     1825.          399.
## 5 HIST_B200    275.       987.       89.2       310.  250.  838.     1825.          399.
## 6 HIST_V4_2    275.       987.       89.2       310.  250.  838.     1825.          399.</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>results_mercuryemis <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="cf">for</span> (subdir <span class="cf">in</span> subdirs) {</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>  file_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(subdir, <span class="st">&quot;GEOSChem.MercuryEmis.alltime_m.nc4&quot;</span>)</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>  </span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file_path)) <span class="cf">next</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>  </span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>  merc_emiss <span class="ot">&lt;-</span> <span class="fu">nc_open</span>(file_path)</span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>  </span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a>  <span class="co"># Temps et poids mensuels</span></span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>  time_raw <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(merc_emiss, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a>  origin_time <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;2015-01-01 00:00:00&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;UTC&quot;</span>)</span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a>  time <span class="ot">&lt;-</span> origin_time <span class="sc">+</span> time_raw <span class="sc">*</span> <span class="dv">60</span></span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a>  weights <span class="ot">&lt;-</span> <span class="fu">days_in_month</span>(time) <span class="sc">/</span> <span class="fu">sum</span>(<span class="fu">days_in_month</span>(time))</span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a>  weighted_avg <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">sum</span>(x <span class="sc">*</span> weights)</span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a>  </span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a>  <span class="co"># Emissions</span></span>
<span id="cb20-18"><a href="#cb20-18" tabindex="-1"></a>  hg0land <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(merc_emiss, <span class="st">&quot;EmisHg0land&quot;</span>)  <span class="co"># [lon, lat, time]</span></span>
<span id="cb20-19"><a href="#cb20-19" tabindex="-1"></a>  hg0soil <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(merc_emiss, <span class="st">&quot;EmisHg0soil&quot;</span>)</span>
<span id="cb20-20"><a href="#cb20-20" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" tabindex="-1"></a>  <span class="co"># Calculs</span></span>
<span id="cb20-22"><a href="#cb20-22" tabindex="-1"></a>  hg0land_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(hg0land, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), weighted_avg)</span>
<span id="cb20-23"><a href="#cb20-23" tabindex="-1"></a>  hg0soil_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(hg0soil, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), weighted_avg)</span>
<span id="cb20-24"><a href="#cb20-24" tabindex="-1"></a>  </span>
<span id="cb20-25"><a href="#cb20-25" tabindex="-1"></a>  total_hg0land <span class="ot">&lt;-</span> <span class="fu">sum</span>(hg0land_mean) <span class="sc">*</span> s_in_yr <span class="sc">*</span> kg_Mg</span>
<span id="cb20-26"><a href="#cb20-26" tabindex="-1"></a>  total_hg0soil <span class="ot">&lt;-</span> <span class="fu">sum</span>(hg0soil_mean) <span class="sc">*</span> s_in_yr <span class="sc">*</span> kg_Mg</span>
<span id="cb20-27"><a href="#cb20-27" tabindex="-1"></a>  </span>
<span id="cb20-28"><a href="#cb20-28" tabindex="-1"></a>  <span class="co"># Ajouter au tableau</span></span>
<span id="cb20-29"><a href="#cb20-29" tabindex="-1"></a>  results_mercuryemis <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(results_mercuryemis, <span class="fu">tibble</span>(</span>
<span id="cb20-30"><a href="#cb20-30" tabindex="-1"></a>    <span class="at">case =</span> <span class="fu">basename</span>(subdir),</span>
<span id="cb20-31"><a href="#cb20-31" tabindex="-1"></a>    <span class="at">hg0land =</span> total_hg0land,</span>
<span id="cb20-32"><a href="#cb20-32" tabindex="-1"></a>    <span class="at">hg0soil =</span> total_hg0soil</span>
<span id="cb20-33"><a href="#cb20-33" tabindex="-1"></a>  ))</span>
<span id="cb20-34"><a href="#cb20-34" tabindex="-1"></a>  </span>
<span id="cb20-35"><a href="#cb20-35" tabindex="-1"></a>  <span class="fu">nc_close</span>(merc_emiss)</span>
<span id="cb20-36"><a href="#cb20-36" tabindex="-1"></a>}</span>
<span id="cb20-37"><a href="#cb20-37" tabindex="-1"></a></span>
<span id="cb20-38"><a href="#cb20-38" tabindex="-1"></a><span class="fu">print</span>(results_mercuryemis)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 3
##   case      hg0land hg0soil
##   &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;
## 1 HIST_B05    134.     839.
## 2 HIST_B10     61.8    839.
## 3 HIST_B100    52.5    839.
## 4 HIST_B150    49.3    839.
## 5 HIST_B200    47.0    839.</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>subdirs <span class="ot">&lt;-</span> <span class="fu">list.dirs</span>(chem_hist, <span class="at">full.names =</span> <span class="cn">TRUE</span>, <span class="at">recursive =</span> <span class="cn">FALSE</span>)</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>subdirs <span class="ot">&lt;-</span> subdirs[<span class="fu">grepl</span>(<span class="st">&quot;HIST_&quot;</span>, <span class="fu">basename</span>(subdirs))]</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="co"># Initialiser les résultats</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>results_drydep <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a><span class="co"># Fonction de moyenne pondérée</span></span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a>weighted_avg <span class="ot">&lt;-</span> <span class="cf">function</span>(x, weights) <span class="fu">sum</span>(x <span class="sc">*</span> weights)</span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a><span class="co"># Boucle sur les cas</span></span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a><span class="cf">for</span> (subdir <span class="cf">in</span> subdirs) {</span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a>  file_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(subdir, <span class="st">&quot;GEOSChem.DryDep.2015_m.nc4&quot;</span>)</span>
<span id="cb22-13"><a href="#cb22-13" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file_path)) <span class="cf">next</span></span>
<span id="cb22-14"><a href="#cb22-14" tabindex="-1"></a>  </span>
<span id="cb22-15"><a href="#cb22-15" tabindex="-1"></a>  drydep_nc <span class="ot">&lt;-</span> <span class="fu">nc_open</span>(file_path)</span>
<span id="cb22-16"><a href="#cb22-16" tabindex="-1"></a>  </span>
<span id="cb22-17"><a href="#cb22-17" tabindex="-1"></a>  <span class="co"># Temps</span></span>
<span id="cb22-18"><a href="#cb22-18" tabindex="-1"></a>  time_raw <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(drydep_nc, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb22-19"><a href="#cb22-19" tabindex="-1"></a>  origin_time <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;2015-01-01 00:00:00&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;UTC&quot;</span>)</span>
<span id="cb22-20"><a href="#cb22-20" tabindex="-1"></a>  time <span class="ot">&lt;-</span> origin_time <span class="sc">+</span> time_raw <span class="sc">*</span> <span class="dv">60</span></span>
<span id="cb22-21"><a href="#cb22-21" tabindex="-1"></a>  days_in_months <span class="ot">&lt;-</span> <span class="fu">days_in_month</span>(time)</span>
<span id="cb22-22"><a href="#cb22-22" tabindex="-1"></a>  weights <span class="ot">&lt;-</span> days_in_months <span class="sc">/</span> <span class="fu">sum</span>(days_in_months)</span>
<span id="cb22-23"><a href="#cb22-23" tabindex="-1"></a>  </span>
<span id="cb22-24"><a href="#cb22-24" tabindex="-1"></a>  <span class="co"># Extraction et traitement des 3 espèces</span></span>
<span id="cb22-25"><a href="#cb22-25" tabindex="-1"></a>  get_drydep_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(varname) {</span>
<span id="cb22-26"><a href="#cb22-26" tabindex="-1"></a>    var <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(drydep_nc, varname)</span>
<span id="cb22-27"><a href="#cb22-27" tabindex="-1"></a>    var <span class="ot">&lt;-</span> <span class="fu">apply</span>(var, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), weighted_avg, <span class="at">weights =</span> weights)</span>
<span id="cb22-28"><a href="#cb22-28" tabindex="-1"></a>    var <span class="ot">&lt;-</span> var <span class="sc">*</span> unit_conv_dd <span class="sc">*</span> kg_Mg</span>
<span id="cb22-29"><a href="#cb22-29" tabindex="-1"></a>    <span class="fu">sum</span>(var, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-30"><a href="#cb22-30" tabindex="-1"></a>  }</span>
<span id="cb22-31"><a href="#cb22-31" tabindex="-1"></a>  </span>
<span id="cb22-32"><a href="#cb22-32" tabindex="-1"></a>  DryDep_Hg0_hist <span class="ot">&lt;-</span> <span class="fu">get_drydep_sum</span>(<span class="st">&quot;DryDep_Hg0&quot;</span>)</span>
<span id="cb22-33"><a href="#cb22-33" tabindex="-1"></a>  DryDep_Hg2_hist <span class="ot">&lt;-</span> <span class="fu">get_drydep_sum</span>(<span class="st">&quot;DryDep_Hg2&quot;</span>)</span>
<span id="cb22-34"><a href="#cb22-34" tabindex="-1"></a>  DryDep_HgP_hist <span class="ot">&lt;-</span> <span class="fu">get_drydep_sum</span>(<span class="st">&quot;DryDep_HgP&quot;</span>)</span>
<span id="cb22-35"><a href="#cb22-35" tabindex="-1"></a>  </span>
<span id="cb22-36"><a href="#cb22-36" tabindex="-1"></a>  <span class="co"># Stocker</span></span>
<span id="cb22-37"><a href="#cb22-37" tabindex="-1"></a>  results_drydep <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(results_drydep, <span class="fu">tibble</span>(</span>
<span id="cb22-38"><a href="#cb22-38" tabindex="-1"></a>    <span class="at">case =</span> <span class="fu">basename</span>(subdir),</span>
<span id="cb22-39"><a href="#cb22-39" tabindex="-1"></a>    <span class="at">drydep_Hg0_tonnes =</span> DryDep_Hg0_hist,</span>
<span id="cb22-40"><a href="#cb22-40" tabindex="-1"></a>    <span class="at">drydep_Hg2_tonnes =</span> DryDep_Hg2_hist,</span>
<span id="cb22-41"><a href="#cb22-41" tabindex="-1"></a>    <span class="at">drydep_HgP_tonnes =</span> DryDep_HgP_hist</span>
<span id="cb22-42"><a href="#cb22-42" tabindex="-1"></a>  ))</span>
<span id="cb22-43"><a href="#cb22-43" tabindex="-1"></a>  </span>
<span id="cb22-44"><a href="#cb22-44" tabindex="-1"></a>  <span class="fu">nc_close</span>(drydep_nc)</span>
<span id="cb22-45"><a href="#cb22-45" tabindex="-1"></a>}</span>
<span id="cb22-46"><a href="#cb22-46" tabindex="-1"></a></span>
<span id="cb22-47"><a href="#cb22-47" tabindex="-1"></a><span class="co"># Afficher les résultats</span></span>
<span id="cb22-48"><a href="#cb22-48" tabindex="-1"></a><span class="fu">print</span>(results_drydep)</span></code></pre></div>
<pre><code>## # A tibble: 7 × 4
##   case      drydep_Hg0_tonnes drydep_Hg2_tonnes drydep_HgP_tonnes
##   &lt;chr&gt;                 &lt;dbl&gt;             &lt;dbl&gt;             &lt;dbl&gt;
## 1 HIST_B05              1576.             1112.              46.6
## 2 HIST_B10              2174.              801.              65.0
## 3 HIST_B100             2242.              747.              67.8
## 4 HIST_B150             2265.              728.              68.8
## 5 HIST_B200             2282.              713.              69.6
## 6 HIST_V3               2162.              810.              64.5
## 7 HIST_V4_2             1576.             1112.              46.6</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="co"># Sous-dossiers HIST_*</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>subdirs <span class="ot">&lt;-</span> <span class="fu">list.dirs</span>(chem_hist, <span class="at">full.names =</span> <span class="cn">TRUE</span>, <span class="at">recursive =</span> <span class="cn">FALSE</span>)</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>subdirs <span class="ot">&lt;-</span> subdirs[<span class="fu">grepl</span>(<span class="st">&quot;HIST_&quot;</span>, <span class="fu">basename</span>(subdirs))]</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a><span class="co"># Initialiser le tableau des résultats</span></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>results_wetloss <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a><span class="co"># Fonction de moyenne pondérée</span></span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a>weighted_avg <span class="ot">&lt;-</span> <span class="cf">function</span>(x, weights) <span class="fu">sum</span>(x <span class="sc">*</span> weights)</span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a><span class="co"># Boucle sur les cas</span></span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a><span class="cf">for</span> (subdir <span class="cf">in</span> subdirs) {</span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a>  file_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(subdir, <span class="st">&quot;GEOSChem.WetLossTot_HgSum.2015_m.nc4&quot;</span>)</span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file_path)) <span class="cf">next</span></span>
<span id="cb24-15"><a href="#cb24-15" tabindex="-1"></a>  </span>
<span id="cb24-16"><a href="#cb24-16" tabindex="-1"></a>  wetloss_nc <span class="ot">&lt;-</span> <span class="fu">nc_open</span>(file_path)</span>
<span id="cb24-17"><a href="#cb24-17" tabindex="-1"></a>  </span>
<span id="cb24-18"><a href="#cb24-18" tabindex="-1"></a>  <span class="co"># Temps</span></span>
<span id="cb24-19"><a href="#cb24-19" tabindex="-1"></a>  time_raw <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(wetloss_nc, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb24-20"><a href="#cb24-20" tabindex="-1"></a>  origin_time <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;2015-01-01 00:00:00&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;UTC&quot;</span>)</span>
<span id="cb24-21"><a href="#cb24-21" tabindex="-1"></a>  time <span class="ot">&lt;-</span> origin_time <span class="sc">+</span> time_raw <span class="sc">*</span> <span class="dv">60</span></span>
<span id="cb24-22"><a href="#cb24-22" tabindex="-1"></a>  days_in_months <span class="ot">&lt;-</span> <span class="fu">days_in_month</span>(time)</span>
<span id="cb24-23"><a href="#cb24-23" tabindex="-1"></a>  weights <span class="ot">&lt;-</span> days_in_months <span class="sc">/</span> <span class="fu">sum</span>(days_in_months)</span>
<span id="cb24-24"><a href="#cb24-24" tabindex="-1"></a>  </span>
<span id="cb24-25"><a href="#cb24-25" tabindex="-1"></a>  <span class="co"># Extraction et traitement</span></span>
<span id="cb24-26"><a href="#cb24-26" tabindex="-1"></a>  wetloss_array <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(wetloss_nc, <span class="st">&quot;WetLossTot_HgSum&quot;</span>)</span>
<span id="cb24-27"><a href="#cb24-27" tabindex="-1"></a>  wetloss_array <span class="ot">&lt;-</span> <span class="fu">apply</span>(wetloss_array, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), weighted_avg, <span class="at">weights =</span> weights)</span>
<span id="cb24-28"><a href="#cb24-28" tabindex="-1"></a>  wetloss_total_tonnes <span class="ot">&lt;-</span> <span class="fu">sum</span>(wetloss_array <span class="sc">*</span> s_in_yr <span class="sc">*</span> kg_Mg, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-29"><a href="#cb24-29" tabindex="-1"></a>  </span>
<span id="cb24-30"><a href="#cb24-30" tabindex="-1"></a>  <span class="co"># Stocker</span></span>
<span id="cb24-31"><a href="#cb24-31" tabindex="-1"></a>  results_wetloss <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(results_wetloss, <span class="fu">tibble</span>(</span>
<span id="cb24-32"><a href="#cb24-32" tabindex="-1"></a>    <span class="at">case =</span> <span class="fu">basename</span>(subdir),</span>
<span id="cb24-33"><a href="#cb24-33" tabindex="-1"></a>    <span class="at">wetloss_Hg_total_tonnes =</span> wetloss_total_tonnes</span>
<span id="cb24-34"><a href="#cb24-34" tabindex="-1"></a>  ))</span>
<span id="cb24-35"><a href="#cb24-35" tabindex="-1"></a>  </span>
<span id="cb24-36"><a href="#cb24-36" tabindex="-1"></a>  <span class="fu">nc_close</span>(wetloss_nc)</span>
<span id="cb24-37"><a href="#cb24-37" tabindex="-1"></a>}</span>
<span id="cb24-38"><a href="#cb24-38" tabindex="-1"></a></span>
<span id="cb24-39"><a href="#cb24-39" tabindex="-1"></a><span class="co"># Afficher les résultats</span></span>
<span id="cb24-40"><a href="#cb24-40" tabindex="-1"></a><span class="fu">print</span>(results_wetloss)</span></code></pre></div>
<pre><code>## # A tibble: 7 × 2
##   case      wetloss_Hg_total_tonnes
##   &lt;chr&gt;                       &lt;dbl&gt;
## 1 HIST_B05                    2865.
## 2 HIST_B10                    1818.
## 3 HIST_B100                   1724.
## 4 HIST_B150                   1694.
## 5 HIST_B200                   1672.
## 6 HIST_V3                     1835.
## 7 HIST_V4_2                   2865.</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="st">&quot;C:/Users/colom/Desktop/STAGE/data/clean_mod_data/14_3_1/HIST_B10/GEOSChem.WetLossTot_HgSum.2015_m.nc4&quot;</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>wetloss_nc <span class="ot">&lt;-</span> <span class="fu">nc_open</span>(file_path)</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="co"># Extraire le temps</span></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>time_raw <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(wetloss_nc, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>origin_time <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;2015-01-01 00:00:00&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;UTC&quot;</span>)</span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>time <span class="ot">&lt;-</span> origin_time <span class="sc">+</span> time_raw <span class="sc">*</span> <span class="dv">60</span>  <span class="co"># en secondes</span></span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>days_in_months <span class="ot">&lt;-</span> <span class="fu">days_in_month</span>(time)</span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>weights <span class="ot">&lt;-</span> days_in_months <span class="sc">/</span> <span class="fu">sum</span>(days_in_months)</span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a><span class="co"># Extraire la variable et appliquer la moyenne pondérée sur le temps</span></span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a>wetloss_array <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(wetloss_nc, <span class="st">&quot;WetLossTot_HgSum&quot;</span>)</span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a>wetloss_array_avg <span class="ot">&lt;-</span> <span class="fu">apply</span>(wetloss_array, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="cf">function</span>(x) <span class="fu">sum</span>(x <span class="sc">*</span> weights))</span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a></span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a><span class="co"># Calcul total en tonnes</span></span>
<span id="cb26-16"><a href="#cb26-16" tabindex="-1"></a>wetloss_total_tonnes <span class="ot">&lt;-</span> <span class="fu">sum</span>(wetloss_array_avg <span class="sc">*</span> s_in_yr <span class="sc">*</span> kg_Mg, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-17"><a href="#cb26-17" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" tabindex="-1"></a><span class="co"># Fermer le fichier NetCDF</span></span>
<span id="cb26-19"><a href="#cb26-19" tabindex="-1"></a><span class="fu">nc_close</span>(wetloss_nc)</span>
<span id="cb26-20"><a href="#cb26-20" tabindex="-1"></a></span>
<span id="cb26-21"><a href="#cb26-21" tabindex="-1"></a><span class="co"># Afficher le résultat</span></span>
<span id="cb26-22"><a href="#cb26-22" tabindex="-1"></a><span class="fu">print</span>(wetloss_total_tonnes)</span></code></pre></div>
<pre><code>## [1] 1817.926</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="co"># Fusionner les tables selon la colonne commune &quot;case&quot;</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>results_all <span class="ot">&lt;-</span> results_wetloss <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>  <span class="fu">full_join</span>(results_drydep, <span class="at">by =</span> <span class="st">&quot;case&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>  <span class="fu">full_join</span>(results_mercuryemis, <span class="at">by =</span> <span class="st">&quot;case&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>  <span class="fu">full_join</span>(results, <span class="at">by =</span> <span class="st">&quot;case&quot;</span>)</span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a><span class="co"># Écrire dans un fichier Excel</span></span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a><span class="fu">write_xlsx</span>(results_all, <span class="st">&quot;C:/Users/colom/Desktop/STAGE/data/clean_mod_data/14_3_1/resultats_mercury.xlsx&quot;</span>)</span></code></pre></div>

</body>
</html>
